# AI Feature - Architecture Deep Dive

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE LAYER                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Dashboard (Next.js)                                             â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  Welcome Message                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ¤– AI VERDICT CARD                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ "Get AI insights on your spending patterns"             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ [Button: "Analyze my spending"]                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ [Loading spinner during request]                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ [Display verdict with markdown formatting]              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Fact 1: ...                                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Fact 2: ...                                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ - Fact 3: ...                                           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         (client/src/components/AIVerdictCard.tsx)                       â”‚
â”‚         (client/src/app/dashboard/page.tsx)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                        HTTPS/WebSocket
                        (with JWT auth)
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND API LAYER (Express)                        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST /api/ai/verdict                                            â”‚   â”‚
â”‚  â”‚ (server/routes/ai.js)                                           â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 1ï¸âƒ£  authMiddleware                                             â”‚   â”‚
â”‚  â”‚     â””â”€ Verify JWT token                                        â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 2ï¸âƒ£  loadUserKnowledgeBase()                                    â”‚   â”‚
â”‚  â”‚     â””â”€ Read facts.json + embeddings.json from disk             â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 3ï¸âƒ£  getQueryEmbedding(question)                                â”‚   â”‚
â”‚  â”‚     â””â”€ POST /embed to ML service                               â”‚   â”‚
â”‚  â”‚        â†“ Get 384-dim vector                                    â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 4ï¸âƒ£  similaritySearch(embedding)                                â”‚   â”‚
â”‚  â”‚     â””â”€ L2 distance: âˆšÎ£(fact_vec - q_vec)Â²                      â”‚   â”‚
â”‚  â”‚        Return top-5 facts                                      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 5ï¸âƒ£  generateVerdict(question, facts)                           â”‚   â”‚
â”‚  â”‚     â””â”€ Call LLM service                                        â”‚   â”‚
â”‚  â”‚        â†“ Get AI-generated insight                              â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚ 6ï¸âƒ£  Return { verdict, factsUsed, question }                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
    (Local Disk)                         (HTTP)
         â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KNOWLEDGE BASE LAYER   â”‚         â”‚    LLM SERVICE LAYER     â”‚
â”‚                          â”‚         â”‚                          â”‚
â”‚ /server/knowledgebase/   â”‚         â”‚ (server/services/       â”‚
â”‚ â”œâ”€ {userId1}/           â”‚         â”‚  llmService.js)         â”‚
â”‚ â”‚  â”œâ”€ facts.json        â”‚         â”‚                          â”‚
â”‚ â”‚  â””â”€ embeddings.json   â”‚         â”‚ generateVerdict()        â”‚
â”‚ â”‚                        â”‚         â”‚ â”œâ”€ Template filling     â”‚
â”‚ â”œâ”€ {userId2}/           â”‚         â”‚ â”œâ”€ Gemini API call      â”‚
â”‚ â”‚  â”œâ”€ facts.json        â”‚         â”‚ â”œâ”€ Error handling       â”‚
â”‚ â”‚  â””â”€ embeddings.json   â”‚         â”‚ â””â”€ Return text          â”‚
â”‚ â”‚                        â”‚         â”‚                          â”‚
â”‚ â””â”€ {userIdN}/           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    â”œâ”€ facts.json        â”‚                   â†“
â”‚    â””â”€ embeddings.json   â”‚              (HTTPS)
â”‚                          â”‚                   â†“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†‘                           â”‚   GOOGLE GEMINI API      â”‚
         â”‚                           â”‚                          â”‚
    Built by                         â”‚ Model:                   â”‚
    (offline job)                    â”‚ gemini-1.5-flash         â”‚
         â”‚                           â”‚                          â”‚
         â”‚                           â”‚ Input: prompt with       â”‚
         â”‚                           â”‚ - Facts                  â”‚
         â”‚                           â”‚ - Question               â”‚
         â”‚                           â”‚ - Rules                  â”‚
         â”‚                           â”‚                          â”‚
         â”‚                           â”‚ Output: text response    â”‚
         â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€ (Offline Phase)
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   OFFLINE BUILD PHASE                                   â”‚
â”‚                                                                          â”‚
â”‚ node server/jobs/buildKnowledgebase.js                                  â”‚
â”‚                                                                          â”‚
â”‚ 1ï¸âƒ£  fetchUserExpenses()                                                â”‚
â”‚     â””â”€ MongoDB query: Expense.find({ userId })                         â”‚
â”‚        Returns: [{ amount, description, date, ... }, ...]              â”‚
â”‚                                                                          â”‚
â”‚ 2ï¸âƒ£  buildFact(expense)                                                 â”‚
â”‚     â””â”€ Format: "â‚¹{amount} spent on {category} at {merchant} on {date}" â”‚
â”‚        Examples:                                                        â”‚
â”‚        â€¢ "â‚¹420 spent on Food at Zomato on 2025-12-29"                 â”‚
â”‚        â€¢ "â‚¹1,200 spent on Transport via Uber on 2025-12-28"           â”‚
â”‚        â€¢ "â‚¹50 spent on Shopping on Amazon on 2025-12-27"              â”‚
â”‚                                                                          â”‚
â”‚ 3ï¸âƒ£  getEmbeddings(facts) [BATCH]                                       â”‚
â”‚     â””â”€ POST /embed to ML service                                       â”‚
â”‚        Input: ["fact1", "fact2", ..., "factN"]                         â”‚
â”‚        Output: [[vec1], [vec2], ..., [vecN]]                           â”‚
â”‚        Model: all-MiniLM-L6-v2 (Sentence Transformers)                 â”‚
â”‚        Dimensions: 384 each                                             â”‚
â”‚                                                                          â”‚
â”‚ 4ï¸âƒ£  saveKnowledgeBase(userId, facts, embeddings)                       â”‚
â”‚     â””â”€ Write to disk:                                                  â”‚
â”‚        â€¢ /server/knowledgebase/{userId}/facts.json                     â”‚
â”‚        â€¢ /server/knowledgebase/{userId}/embeddings.json                â”‚
â”‚                                                                          â”‚
â”‚ Schedule: Every 6-12 hours (or on-demand)                              â”‚
â”‚ Example cron: 0 */6 * * * cd /path && node jobs/buildKnowledgebase.js â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ML SERVICE LAYER (FastAPI)                           â”‚
â”‚                                                                          â”‚
â”‚ (ml/app.py)                                                             â”‚
â”‚                                                                          â”‚
â”‚ POST /embed                                                             â”‚
â”‚ â”œâ”€ Input: { "texts": ["text1", "text2", ...] }                         â”‚
â”‚ â””â”€ Processing:                                                          â”‚
â”‚    â€¢ Load model: SentenceTransformer("all-MiniLM-L6-v2")                â”‚
â”‚    â€¢ Encode texts â†’ 384-dim vectors                                    â”‚
â”‚    â€¢ Convert to JSON list                                              â”‚
â”‚    â””â”€ Output: { "embeddings": [[...], [...], ...] }                    â”‚
â”‚                                                                          â”‚
â”‚ GET /health                                                             â”‚
â”‚ â””â”€ Response: { "status": "healthy" }                                    â”‚
â”‚                                                                          â”‚
â”‚ POST /classify (existing)                                              â”‚
â”‚ â””â”€ Classify expense category (separate from AI feature)                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA STORAGE LAYER                               â”‚
â”‚                                                                          â”‚
â”‚ MongoDB (Primary)                                                       â”‚
â”‚ â””â”€ Collections:                                                         â”‚
â”‚    â€¢ users                                                              â”‚
â”‚    â€¢ expenses  â† Used by buildKnowledgebase                             â”‚
â”‚    â€¢ analytics                                                          â”‚
â”‚                                                                          â”‚
â”‚ Local Filesystem (Knowledge Bases)                                      â”‚
â”‚ â””â”€ /server/knowledgebase/                                               â”‚
â”‚    â””â”€ {userId}/                                                         â”‚
â”‚       â”œâ”€ facts.json        (JSON array of strings)                      â”‚
â”‚       â””â”€ embeddings.json   (JSON array of vectors)                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

### Offline Phase (Scheduled/On-Demand)

```
Expense Entry
(User adds expense)
    â†“
MongoDB Expense
Collection
    â†“
buildKnowledgebase.js
    â”œâ”€ Query: All expenses for user
    â”œâ”€ Process: Build facts
    â”œâ”€ Embed: Send to ML service
    â””â”€ Store: Save KB files
    â†“
Knowledge Base Created
/server/knowledgebase/{userId}/
```

### Online Phase (Request-Time)

```
User clicks "Analyze my spending"
(Frontend event)
    â†“
AIVerdictCard.handleAnalyze()
    â”œâ”€ State: setLoading(true)
    â””â”€ Fetch: POST /api/ai/verdict
    â†“
Backend: POST /api/ai/verdict
    â”œâ”€ Auth: Verify JWT
    â”œâ”€ Load: KB from disk
    â”œâ”€ Embed: Question â†’ vector
    â”œâ”€ Search: Top-5 facts by L2 distance
    â”œâ”€ LLM: Call Gemini with facts
    â””â”€ Return: { verdict, factsUsed, question }
    â†“
Frontend receives response
    â”œâ”€ State: setLoading(false)
    â”œâ”€ State: setVerdict(data.verdict)
    â””â”€ Render: Display verdict
    â†“
User sees AI insights
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Component       â”‚
â”‚ (AIVerdictCard.tsx)     â”‚
â”‚                         â”‚
â”‚ useState:               â”‚
â”‚ â€¢ loading               â”‚
â”‚ â€¢ verdict               â”‚
â”‚ â€¢ error                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ onClick="handleAnalyze"
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch('/api/ai/verdict', {               â”‚
â”‚   method: 'POST',                        â”‚
â”‚   headers: {                             â”‚
â”‚     'Authorization': 'Bearer {jwt}'       â”‚
â”‚   },                                     â”‚
â”‚   body: JSON.stringify({                 â”‚
â”‚     question: '...'                      â”‚
â”‚   })                                     â”‚
â”‚ })                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ (Express Router)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ server/routes/ai.js                      â”‚
â”‚                                          â”‚
â”‚ router.post('/verdict', auth, handler)   â”‚
â”‚                                          â”‚
â”‚ 1. Load KB from disk                     â”‚
â”‚ 2. Embed question                        â”‚
â”‚ 3. Search similarities                   â”‚
â”‚ 4. Call LLM                              â”‚
â”‚ 5. Return response                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ (HTTP Response)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ { verdict, factsUsed, question }         â”‚
â”‚                                          â”‚
â”‚ verdict: "Based on your spending..."     â”‚
â”‚ factsUsed: ["â‚¹420 spent on...", ...]    â”‚
â”‚ question: "Why am I..."                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update component state                   â”‚
â”‚                                          â”‚
â”‚ setVerdict(response.verdict)             â”‚
â”‚ setState(response.factsUsed)             â”‚
â”‚ setLoading(false)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render UI                                â”‚
â”‚                                          â”‚
â”‚ Display verdict (markdown)               â”‚
â”‚ Show facts used (collapsed)              â”‚
â”‚ Update button state                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

```
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Next.js 14+ (React)                      â”‚
â”‚ â€¢ TypeScript                               â”‚
â”‚ â€¢ Tailwind CSS (styling)                   â”‚
â”‚ â€¢ fetch API (HTTP client)                  â”‚
â”‚ â€¢ useState (state management)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ BACKEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Node.js 16+                              â”‚
â”‚ â€¢ Express.js 5+                            â”‚
â”‚ â€¢ Mongoose (MongoDB ODM)                   â”‚
â”‚ â€¢ Axios (HTTP client)                      â”‚
â”‚ â€¢ @google/generative-ai (Gemini API)       â”‚
â”‚ â€¢ jsonwebtoken (JWT auth)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ML SERVICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Python 3.9+                              â”‚
â”‚ â€¢ FastAPI (Web framework)                  â”‚
â”‚ â€¢ Uvicorn (ASGI server)                    â”‚
â”‚ â€¢ Sentence Transformers (embeddings)       â”‚
â”‚ â€¢ Torch (deep learning)                    â”‚
â”‚ â€¢ Transformers (model hub)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DATABASES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ MongoDB (primary data store)             â”‚
â”‚ â€¢ Local Filesystem (KB files)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ EXTERNAL APIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Google Generative AI (Gemini 1.5 Flash)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scaling Considerations

### Current Architecture (Development/Small Scale)

```
Single Server Setup
â”œâ”€ Node.js Backend (port 5000)
â”œâ”€ Python ML Service (port 8000)
â”œâ”€ MongoDB (local or managed)
â””â”€ Knowledge Bases (local disk)

Capacity: ~10k users with active verdicts
```

### Phase 2 (Medium Scale)

```
â”œâ”€ Load Balancer
â”‚  â”œâ”€ Backend Cluster (multiple Node.js instances)
â”‚  â”œâ”€ ML Service Cluster (multiple Python instances)
â”‚  â””â”€ Cache Layer (Redis for KB caching)
â”œâ”€ MongoDB Cluster (replica set)
â””â”€ Shared Storage (S3/GCS for KBs)

Capacity: ~100k users
```

### Phase 3 (Large Scale)

```
â”œâ”€ CDN (for frontend)
â”œâ”€ API Gateway with rate limiting
â”‚  â”œâ”€ Backend Auto-Scaling Group
â”‚  â”œâ”€ ML Service Auto-Scaling Group (GPU)
â”‚  â”œâ”€ Cache Layer (Redis/Memcached)
â”‚  â””â”€ Vector DB (Pinecone/Weaviate)
â”œâ”€ MongoDB Atlas (managed)
â”œâ”€ Message Queue (RabbitMQ for KB builds)
â””â”€ Monitoring (Datadog/NewRelic)

Capacity: 1M+ users
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTPS/TLS                               â”‚
â”‚ (All network traffic encrypted)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JWT Authentication                      â”‚
â”‚ (Issued at login, verified per request) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Key Management                      â”‚
â”‚ (GOOGLE_API_KEY in .env, not logged)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Privacy                            â”‚
â”‚ (User sees only their KB)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Handling                          â”‚
â”‚ (No sensitive data in error messages)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of Architecture Documentation**
